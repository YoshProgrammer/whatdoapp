var whatdoapp=angular.module("whatdoapp",["ngRoute","ngCookies","loading-bar","fab-directive","enplug.sdk.utils","enplug.utils","ui.bootstrap","ui.gravatar","ngDialog","NavCtrl","CreateTodoCtrl","MainCtrl","LoginCtrl","SignUpCtrl","TodosCtrl","AccountCtrl","AuthServ","LoginServ","SignUpServ","ToDoServ","ScriptLoaderService","angular-filepicker","angular-loading-bar","oitozero.ngSweetAlert","datepicker"]);whatdoapp.config(["$routeProvider","$locationProvider","filepickerProvider","cfpLoadingBarProvider",function(a,b,c,d){c.setKey("AWcZnYpZyQrOBLrdpNDNzz"),b.html5Mode(!0),a.when("/",{templateUrl:"views/home.html",controller:"MainController",resolve:{loggedIn:["AuthService","$location","$route",function(a,b,c){a.isLoggedIn()||b.path("/login")}]}}).when("/user/account",{templateUrl:"views/account.html",controller:"AccountController",resolve:{user:["AuthService",function(a){return a.getUser()}],todos:["AuthService","$location","ToDoService",function(a,b,c){return c.getTodos()}]}}).when("/signup",{templateUrl:"views/sign-up.html",controller:"SignUpController"}).when("/login",{templateUrl:"views/login.html",controller:"LoginController"}).when("/user/add-todo",{templateUrl:"views/create-todo.html",controller:"CreateTodosController",resolve:{todo:function(){return null},user:["AuthService",function(a){return a.getUser()}]}}).when("/todo/edit/:todoId",{templateUrl:"views/create-todo.html",controller:"CreateTodosController",resolve:{todo:["ToDoService","$route",function(a,b){return a.getTodo(b.current.params.todoId)}],user:["AuthService",function(a){return a.getUser()}]}}).when("/user/todos",{templateUrl:"views/todos.html",controller:"TodosController",resolve:{todos:["AuthService","$location","ToDoService",function(a,b,c){return c.getTodos()}]}}).otherwise({redirectTo:"/"})}]),angular.module("AccountCtrl",[]).controller("AccountController",["$scope","user","todos",function(a,b,c){"use strict";a.user=b.data,a.todos=c.data,a.totalTodos=c.data.length+" todos. View",console.log("User: ",b)}]),angular.module("CreateTodoCtrl",[]).controller("CreateTodosController",["$scope","ToDoService","$location","filepickerService","$timeout","SweetAlert","todo","user",function(a,b,c,d,e,f,g,h){function i(){b.createTodo(a.todo).then(function(b){f.success("Success","Todo: "+a.todo.description+" created"),console.log("Todo: ",b),c.path("/user/todos")},function(a){console.log("Error"),f.error("Oops","An error has occurred. Please try again.")})}function j(){b.updateTodo(a.todo).then(function(b){f.success("Success","Todo: "+a.todo.description+" updated"),c.path("/user/todos")},function(a){console.log("Error"),f.error("Oops","An error has occurred. Please try again.")})}function k(){d.pick(l)}function l(b){console.log("Blob: ",b),a.todo.file=b.url,a.todo.fileName=b.filename}a.todo=g||b.newTodo(),a.email=b.newEmail(),console.log("Todo: ",a.todo),a.priorityLevels=[{name:"Minor",level:1},{name:"Normal",level:2},{name:"Major",level:3}],a.createOrUpdateTodo=function(){a.todo.id?e(j,500):e(i,500)},a.sendEmail=function(){var c=a.todo.dueDate?a.todo.dueDate:"soon";a.email.to=h.data.email,a.email.text="Your todo: "+a.todo.description+" is due "+c+". Please login to WhatDo App at http://www.whatdoapp.com to view todos.",a.email.sendAt=moment().unix(),b.createEmail(a.email).then(function(a){f.success("Success","Email successfully scheduled"),console.log("Email: ",a)},function(a){f.error("Oops","An error has occurred. Please try again.")})},a.today=function(){a.dt=new Date},a.pickFile=k,a.onSuccess=l,a.today(),a.clear=function(){a.todo.dueDate=null},a.open=function(b){a.status.opened=!0},a.setDate=function(b,c,d){a.todo.dueDate=new Date(b,c,d)},a.status={opened:!1}}]),angular.module("LoginCtrl",[]).controller("LoginController",["$scope","LoginService","$cookies","$location","SignUpService","SweetAlert",function(a,b,c,d,e,f){"use strict";function g(a){f.error("Oops",a)}function h(){return e.registerUser(a.user)}a.user={firstName:"",lastName:"",email:"",password:"",accountName:""},a.createAccount=null,a.toggleAccount=function(){a.createAccount=!a.createAccount},a.login=function(){return b.login(a.user).then(function(a){c.put("token",a.data._token),d.path("/")},function(){g("Invalid username or password, try again")})},a.createUser=function(){h().then(function(){a.login()},function(a){g("Something went wrong.")})}}]),angular.module("MainCtrl",[]).controller("MainController",["$scope","AuthService",function(a,b){a.logout=function(){b.logout().then(function(a){console.log("Woo: ",a)})}}]),angular.module("NavCtrl",[]).controller("NavTitleController",["$scope","$location","AuthService",function(a,b,c){"use strict";a.logout=function(){c.logout().then(function(){a.hideTitle=!0,b.path("/login")})},a.$on("$routeChangeSuccess",function(){a.hideTitle=!("/login"!==b.path()&&"/signup"!==b.path()),a.hideHome="/"===b.path()}),c.getUser().then(function(b){console.log("Data: ",b),a.user=b.data})}]),angular.module("SignUpCtrl",[]).controller("SignUpController",["$scope","SignUpService",function(a,b){a.user={email:"",password:""},a.createUser=function(){b.registerUser(a.user).then(function(a){console.log("Success: ",a)})}}]),angular.module("TodosCtrl",[]).controller("TodosController",["$scope","ToDoService","$cookies","todos","Confirm","$route","$timeout","SweetAlert","$location",function(a,b,c,d,e,f,g,h,i){function j(a){var c=a.completed?" completed":" uncompleted";return b.updateTodo(a).then(function(a){console.log("Todo",a),h.success("Todo Status","Todo marked as "+c)},function(a){console.log("Error"),h.error("Oops","An error has occurred. Please try again.")})}function k(a){return b.deleteTodo(a.id).then(function(){f.reload()})}a.todos=d.data,a.priorityLevelsMap={1:"Major",2:"Normal",3:"Minor"},a.deleteTodo=function(a){var b="Delete todo?",c="Are you sure you want to delete the todo: "+a.description+"? This action cannot be undone.";h.confirm(b,c,k,a)},a.editTodo=function(a){i.path("/todo/edit/"+a)},a.markCompleted=function(a){j(a).then(function(){f.reload()})}}]),angular.module("datepicker",[]).directive("uibDatepickerPopup",function(){return{restrict:"EAC",require:"ngModel",link:function(a,b,c,d){d.$formatters.shift()}}}),angular.module("fab-directive",[]).directive("fab",["$log","Loading","$timeout",function(a,b,c){return{restrict:"E",template:'<div><div class="fab" ng-class="{ open: open}"><a id="fab-circle"></a><i class="ion-navicon"></i> <i class="ion-close"></i> <img src="@@path/img/tail-spin.svg" width="30px"><span id="fab-message" ng-bind="message"></span> <span id="fab-width-calculator"></span> </a><li> <a href="/developers"> <i class="ion-settings"></i> <span>My Apps</span></a></li><li><a href="/network/monitoring"><i class="ion-network"></i><span>Monitoring</span></a></li><li><a href="/developers/apps/new-app"><i class="ion-plus-circled"></i><span>New app</span></a></li></ul> </div> </div></div>',scope:!0,replace:!0,link:function(a,d){function e(a){return angular.element(d[0].querySelector(a))}function f(a){var b=a.offsetWidth,c=getComputedStyle(a);return b+=parseInt(c.marginLeft)+parseInt(c.marginRight)}function g(a){return m.text(a),f(m[0])}function h(a){var b,c;a?(c=g(a)+10,b=c+i+j,k.css({width:b+"px"}),l.css({width:c+"px"})):(k[0].removeAttribute("style"),l.css({width:"0px"}))}var i=30,j=50,k=e("#fab-circle"),l=e("#fab-message"),m=e("#fab-width-calculator");b.onStart(function(b){h(b),d.addClass("loading"),a.message=b}),b.onSuccess(function(b){h(b),d.addClass("loading"),d.removeClass("loading-error"),d.addClass("loading-success"),a.message=b,c(function(){h(""),d.removeClass("loading"),d.removeClass("loading-success")},2e3)}),b.onError(function(b){d.addClass("loading"),d.addClass("loading-error"),h(b),a.message=b,c(function(){h(),d.removeClass("loading"),d.removeClass("loading-error")},2e3)}),d.find("a").on("click",function(){c(function(){a.open=!a.open})}),d.on("mouseenter",function(){d.hasClass("loading")||a.$apply(function(){a.open=!0})}),d.on("mouseleave",function(){a.$apply(function(){a.open=!1})})}}}]),angular.module("AuthServ",[]).factory("AuthService",["$http","$log","$cookies",function(a,b,c){"use strict";return{isLoggedIn:function(){return!!(c.get("token")&&c.get("token").length>15)},logout:function(){return console.log("Hit @ logout",c.get("token")),a({method:"POST",url:"/api/logout",headers:{Auth:c.get("token")}}).then(function(a){return c.put("token","",{expires:"-1"}),console.log("Cookie: ",c.get("token")),a})},getUser:function(){return a({method:"GET",url:"/api/user",headers:{Auth:c.get("token")}}).then(function(a){return console.log("User: ",a),a})}}}]),angular.module("loading-bar",[]).factory("Loading",["$log","$timeout","$q",function(a,b,c){function d(a){k=!0,b(function(){k=!1},a)}function e(a,b){return _.isFunction(a.error)?a.error(b):_.isString(a.error)?a.error:b}function f(a){var b;return a.promise.then(function(d){return b=_.isFunction(a.success)?a.success(d):a.success,g(h,b,c.defer()).then(function(){return d})},function(d){return b=e(a,d),g(i,b,c.defer()).then(function(){return c.reject(d)})})}function g(a,c,d){return"function"==typeof a&&(k?b(function(){g(a,c,d)},m):(a(c),b(function(){d.resolve()},l))),d.promise}var h,i,j,k=!1,l=150,m=100,n={loading:"Loading",success:"Complete",error:null,lockDuration:700};return{start:function(b){return b=_.assign(n,b),_.isObject(b.promise)&&_.isFunction(b.promise.then)?(_.isFunction(j)?j(b.loading):a.warn("WARNING: No callback registered with Loader for options: ",b),d(b.lockDuration),f(b)):void a.error("ERROR: invalid promise passed to Loader.")},show:function(a){return a=a||n.loading,j(a),d(n.lockDuration),c.when()},success:function(a){return a=a||n.success,g(h,a,c.defer())},error:function(a){return a=a||"Error",g(i,a,c.defer())},onStart:function(a){j=a},onSuccess:function(a){h=a},onError:function(a){i=a},lock:function(a,d){function e(a){f?b(function(){e(a)},m):a()}d="undefined"==typeof d?n.lockDuration:d;var f=!0;b(function(){f=!1},d);var g=c.defer();return a.then(function(a){e(function(){g.resolve(a)})},function(a){e(function(){g.reject(a)})}),g.promise}}}]),angular.module("LoginServ",[]).factory("LoginService",["$http",function(a){"use strict";return{login:function(b){return a({method:"POST",url:"/api/users/login",data:{email:b.email,password:b.password}}).then(function(a){return console.log("Successful login"),a})}}}]),angular.module("ScriptLoaderService",[]).factory("ScriptLoaderService",["$q","$document","$timeout",function(a,b,c){"use strict";return{loadScript:function(d,e){var f=a.defer(),g=b[0].createElement("script");return g.src=e,b[0].body.appendChild(g),g.onload=g.onreadystatechange=function(){c(function(){d()?f.resolve():f.reject("Error occurred. Please try again.")})},g.onerror=function(){c(function(){f.reject("Error. Please try again.")})},f.promise}}}]),angular.module("SignUpServ",[]).factory("SignUpService",["$http","$log",function(a,b){"use strict";return{registerUser:function(b){return a({method:"POST",url:"/api/user",data:{email:b.email,password:b.password,firstName:b.firstName,lastName:b.lastName,accountName:b.accountName}}).then(function(a){return a})}}}]),angular.module("ToDoServ",[]).factory("ToDoService",["$http","$log","$cookies",function(a,b,c){"use strict";var d=c.get("token"),e={Auth:d};return{newTodo:function(){return{description:null,dueDate:null,file:null,fileName:null,priority:null,completed:!1}},newEmail:function(){return{to:"",from:"notifications@whatdoapp.com",subject:"ToDo App Notification",text:"",sendAt:null}},createEmail:function(b){return a({method:"POST",url:"/user/send-email",headers:e,data:b}).then(function(a){return console.log("Data: ",a),a})},createTodo:function(c){return b.debug("Todo: ",c),b.debug("Token: ",d),a({method:"POST",url:"/api/todos",headers:e,data:c}).then(function(a){return a})},updateTodo:function(b){return a({method:"PUT",url:"/api/todos/"+b.id,headers:e,data:b}).then(function(a){return a})},getTodo:function(b){return a({method:"GET",url:"/api/todos/"+b,headers:e}).then(function(a){return console.log("Data: ",a),a.data})},getTodos:function(){return a({method:"GET",url:"/api/todos",headers:e}).then(function(a){return a})},deleteTodo:function(b){return a({method:"DELETE",url:"/api/todos/"+b,headers:e}).then(function(a){return a})}}}]);